<div class="castrol-table-container mt-4">
  <div class="inv-header-section">
    <div class="inv-header-content">
      <div class="inv-title-wrapper">
        <i class="bi bi-box-seam inv-icon"></i>
        <h1 class="inv-main-title">Inventario</h1>
      </div>
      <p class="inv-subtitle">Administra productos, stock y precios</p>
    </div>

    <div class="inv-actions-group">
      <button class="castrol-btn-add" (click)="abrirProductoModal()">
        <i class="bi bi-plus-circle-dotted me-2"></i> Agregar Producto
      </button>
    </div>
  </div>

  <div class="d-flex justify-content-between align-items-center mb-3" style="gap:14px; flex-wrap:wrap;">
    <div class="ventas-stats-badge">
      <i class="bi bi-list-check"></i>
      <span>{{ totalItems }} productos</span>
    </div>

    <div class="ventas-tools">
      <div class="ventas-search">
        <i class="bi bi-search"></i>
        <input
          type="search"
          placeholder="Buscar por número de parte, producto, marca, categoría..."
          [(ngModel)]="filtro"
          (ngModelChange)="onFilterChange()"
        />
        <button
          type="button"
          class="clear-btn"
          *ngIf="filtro"
          (click)="clearFilter()"
          title="Limpiar"
        >
          <i class="bi bi-x-lg"></i>
        </button>
      </div>

      <div class="ventas-meta">
        <div class="range">
          {{ pageStartIndex + 1 }}–{{ pageEndIndex }} de {{ totalItems }}
        </div>

        <div class="ventas-page-size">
          <span>Mostrar</span>
          <select
            [(ngModel)]="pageSize"
            (ngModelChange)="onPageSizeChange($event)"
          >
            <option *ngFor="let n of pageSizeOptions" [ngValue]="n">{{ n }}</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <div class="table-responsive">
    <table class="castrol-table">
      <thead>
        <tr>
          <th style="width:70px;">#</th>
          <th style="min-width:180px;">Número de parte</th>
          <th style="min-width:260px;">Producto</th>
          <th style="width:140px;">Precio</th>
          <th style="width:110px;">Stock</th>
          <th style="min-width:160px;">Categoría</th>
          <th style="min-width:160px;">Marca</th>
          <th style="width:150px;">Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let item of inventarioPaginado; let i = index">
          <td class="fw-semibold">{{ pageStartIndex + i + 1 }}</td>
          <td>{{ item.part_number ?? '-' }}</td>
          <td>{{ item.product_name ?? '-' }}</td>

          <td class="fw-semibold">
            {{ (item.price ?? 0) | currency:'MXN':'symbol-narrow':'1.2-2' }}
          </td>

          <td>{{ item.stock ?? '-' }}</td>
          <td>{{ item.category_name ?? '-' }}</td>
          <td>{{ item.brand_name ?? '-' }}</td>

          <td class="acciones-cell">
            <div class="action-group">
              <button class="action-btn btn-edit" aria-label="Editar" data-tooltip="Editar">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.004 1.004 0 0 0 0-1.42l-2.34-2.34a1.004 1.004 0 0 0-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.82z"/>
                </svg>
              </button>
              <button class="action-btn btn-delete" aria-label="Eliminar" data-tooltip="Eliminar">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M9 3h6l1 1h4v2H4V4h4l1-1zm1 7h2v8h-2v-8zm4 0h2v8h-2v-8zM6 7h12l-1 13a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2L6 7z"/>
                </svg>
              </button>
            </div>
          </td>
        </tr>

        <tr *ngIf="inventarioPaginado.length === 0">
          <td colspan="8" class="text-muted text-center py-4">
            No hay datos de inventario disponibles.
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="ventas-pager" *ngIf="totalItems > 0">
    <button class="pager-btn" (click)="prevPage()" [disabled]="page <= 1">
      <i class="bi bi-chevron-left"></i> Anterior
    </button>

    <div class="pager-pages">
      <button
        *ngFor="let p of pagesToShow"
        class="page-btn"
        [class.active]="p === page"
        [class.dots]="p === '...'"
        [disabled]="p === '...'"
        (click)="onPageClick(p)"
        type="button"
      >
        {{ p }}
      </button>
    </div>

    <button class="pager-btn" (click)="nextPage()" [disabled]="page >= totalPages">
      Siguiente <i class="bi bi-chevron-right"></i>
    </button>
  </div>

  <div class="color-modal-backdrop" *ngIf="colorModalAbierto" (click)="cerrarColorModal()"></div>
  <div class="color-modal" *ngIf="colorModalAbierto">
    <h4><b>Selecciona un color</b></h4>
    <div class="color-options">
      <div *ngFor="let color of colores" style="display: flex; flex-direction: column; align-items: center;">
        <button
          [ngStyle]="{'background': color.value, 'color': '#fff'}"
          (click)="cambiarColor(color.value)">
        </button>
        <span style="margin-top: 3px; font-size: 0.80em;">{{color.nombre}}</span>
      </div>
    </div>
    <button class="castrol-btn-add" style="margin-top:1em;" (click)="cerrarColorModal()">Cerrar</button>
  </div>

  <div class="producto-modal" *ngIf="productoModalAbierto">
    <h1 class="producto-modal-title"><b>Agregar producto</b></h1>
    <form autocomplete="off" (ngSubmit)="addProduct()" #formRef="ngForm">
      <div class="producto-form-grid">
        <div class="grid-col-span">
          <label>Marca</label>
          <select name="brand"
            [(ngModel)]="form.brand"
            required class="my-1 mr-sm-2">
            <option [ngValue]="null" disabled>Selecciona una</option>
            <option *ngFor="let brand of brands" [ngValue]="brand.id">
              {{brand.namee}}
            </option>
          </select>
        </div>

        <div>
          <label>Categoría</label>
          <select name="category"
            [(ngModel)]="form.category"
            required class="my-1 mr-sm-2">
            <option [ngValue]="null" disabled>Selecciona una</option>
            <option *ngFor="let cat of categorys" [ngValue]="cat.id">
              {{cat.namee}}
            </option>
          </select>
        </div>

        <div class="grid-col-span">
          <label>Número de parte</label>
          <input type="text"
            name="partNumber"
            [(ngModel)]="form.partNumber"
            required class="my-1 mr-sm-2">
        </div>

        <div class="grid-col-span-3">
          <label>Nombre</label>
          <input type="text"
            name="name"
            [(ngModel)]="form.name"
            required class="my-1 mr-sm-2">
        </div>

        <div>
          <label>Precio</label>
          <input type="number"
            step="0.01"
            name="price"
            [(ngModel)]="form.price"
            required
            class="my-1 mr-sm-2"
            placeholder="0.00">
        </div>

        <div>
          <label>Stock</label>
          <input type="number"
            name="stock"
            [(ngModel)]="form.stock"
            min="0"
            required
            class="my-1 mr-sm-2"
            placeholder="1">
        </div>
      </div>

      <div class="producto-modal-actions">
        <button type="button" class="producto-cancel-btn" (click)="cerrarProductoModal()">Cancelar</button>
        <button type="submit" class="producto-save-btn" [disabled]="formRef.invalid">Guardar</button>
      </div>
    </form>
  </div>
</div>
